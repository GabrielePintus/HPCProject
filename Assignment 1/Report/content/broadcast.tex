% \newpage

\subsection{Broadcast}
    The broadcast operation is used to send a message from the root
    process to all the other processes in the communicator. 
    This is useful when the root process has a block of data that needs
    to be entirely copied to all the other processes. \\
    The parameters for the tests are:
    \begin{itemize}
        \item iterations: 10000
        \item warmup: 1000
        \item algorithms: basic linear, chain, binary tree, binomial tree
        \item message size: 1byte $\rightarrow$ 1 Mb
        \item number of processes: $2, 4, \dots, 48$
    \end{itemize}
    Herafter we report the results for this operation considering three
    different message sizes: 2 bytes, 1 Kb, and 1 Mb. We expect to notice
    a significant increase in the latency when the MPI processes fill
    the socket and even more when they fill the node. This is due to the
    fact that the communication is done through the network and not through
    the shared memory.
    \begin{figure}[H]
        \centering
        \resizebox{0.45\textwidth}{!}{
        \begin{tikzpicture}
            \begin{axis}[
                title={Broadcast test (2 bytes)},
                xlabel={Number of processes},
                ylabel={Latency ($\mu$s)},
                legend pos=north west,
                grid=both,
                grid style={line width=.1pt, draw=gray!20},
                major grid style={line width=.2pt,draw=gray!50},
                minor tick num=5,
                xtick={2, 6, 12, 18, 24, 30, 36, 42, 48},
                % xmode=log,
                % log basis x={2},
                % ymin=0,
                % xmin=0.5,
                % xmax=11.5,
                % xmax=100,
                % ytick={0, 50, 100, 150, 200, 250, 300, 350, 400},
                width=10cm,
                height=6cm,
                % cycle list name=color list,
            ]
            
            % x = [ 2  4  6  8 10 12 14 16 18 20 22 24 26 28 30 32 34 36 38 40 42 44 46 48]
            % basic-linear = [0.19 0.21 0.31 0.71 0.94 0.95 0.99 1.6  2.37 2.33 2.53 2.6  2.42 2.43 2.84 3.36 4.81 4.92 4.21 4.22 4.53 4.44 4.62 5.17]
            % chain = [0.21 0.21 0.36 0.64 0.91 0.99 0.9  1.27 2.33 2.46 2.42 2.28 2.17 2.14  2.24 2.57 4.84 4.67 4.36 4.3  4.21 3.59 3.78 4.13]
            % binary-tree = [0.21 0.32 0.51 0.7  0.93 0.99 0.95 1.27 2.2  2.2  2.07 2.04 1.75 1.77  1.84 2.37 3.95 3.78 3.64 3.52 3.26 3.18 3.27 3.34]
            % binomial = [0.2  0.33 0.45 0.69 0.8  0.84 0.81 1.13 2.29 2.12 1.94 1.83 1.54 1.52  1.5  2.1  3.9  3.63 3.38 3.33 3.08 3.07 2.87 2.99]
            
            % Blue line: basic-linear
            \addplot[
                color=blue,
                mark=none,
                ]
                coordinates {
                (2, 0.19)
                (4, 0.21)
                (6, 0.31)
                (8, 0.71)
                (10, 0.94)
                (12, 0.95)
                (14, 0.99)
                (16, 1.6)
                (18, 2.37)
                (20, 2.33)
                (22, 2.53)
                (24, 2.6)
                (26, 2.42)
                (28, 2.43)
                (30, 2.84)
                (32, 3.36)
                (34, 4.81)
                (36, 4.92)
                (38, 4.21)
                (40, 4.22)
                (42, 4.53)
                (44, 4.44)
                (46, 4.62)
                (48, 5.17)
                };
                \addlegendentry{Basic Linear}

            % Orange line: chain
            \addplot[
                color=orange,
                mark=none,
                ]
                coordinates {
                (2, 0.21)
                (4, 0.21)
                (6, 0.36)
                (8, 0.64)
                (10, 0.91)
                (12, 0.99)
                (14, 0.9)
                (16, 1.27)
                (18, 2.33)
                (20, 2.46)
                (22, 2.42)
                (24, 2.28)
                (26, 2.17)
                (28, 2.14)
                (30, 2.24)
                (32, 2.57)
                (34, 4.84)
                (36, 4.67)
                (38, 4.36)
                (40, 4.3)
                (42, 4.21)
                (44, 3.59)
                (46, 3.78)
                (48, 4.13)
                };
                \addlegendentry{Chain}

            % Green line: binary-tree
            \addplot[
                color=green,
                mark=none,
                ]
                coordinates {
                (2, 0.21)
                (4, 0.32)
                (6, 0.51)
                (8, 0.7)
                (10, 0.93)
                (12, 0.99)
                (14, 0.95)
                (16, 1.27)
                (18, 2.2)
                (20, 2.2)
                (22, 2.07)
                (24, 2.04)
                (26, 1.75)
                (28, 1.77)
                (30, 1.84)
                (32, 2.37)
                (34, 3.95)
                (36, 3.78)
                (38, 3.64)
                (40, 3.52)
                (42, 3.26)
                (44, 3.18)
                (46, 3.27)
                (48, 3.34)
                };
                \addlegendentry{Binary Tree}

            % Red line: binomial
            \addplot[
                color=red,
                mark=none,
                ]
                coordinates {
                (2, 0.2)
                (4, 0.33)
                (6, 0.45)
                (8, 0.69)
                (10, 0.8)
                (12, 0.84)
                (14, 0.81)
                (16, 1.13)
                (18, 2.29)
                (20, 2.12)
                (22, 1.94)
                (24, 1.83)
                (26, 1.54)
                (28, 1.52)
                (30, 1.5)
                (32, 2.1)
                (34, 3.9)
                (36, 3.63)
                (38, 3.38)
                (40, 3.33)
                (42, 3.08)
                (44, 3.07)
                (46, 2.87)
                (48, 2.99)
                };
                \addlegendentry{Binomial}
            
            \end{axis}
        \end{tikzpicture}
        }
    \end{figure}
    When processes are within the same socket, they can share cache more
    efficiently, leading to lower latency. However, once the first socket
    is fully utilized and processes start to run on the second socket,
    inter-socket communication requires maintaining cache coherence
    across sockets, which introduces additional latency. This causes
    the rapid increase in latency we can observe in the interval from
    12 to 18 processes (remember that we have 12 cores per socket).
    After that, the beneficial effect of the cache helps reducing the
    latency until the second socket is fully utilized. Then the second
    node is used and the latency drastically increases again. This
    require network communication, which is even slower.
    Once more, the cache of the second node helps reducing the latency. \\
    The best overall performing algorithm is the binomial, which 
    consistently outperforms the other algorithms. Since the message
    size is very small, we cannot observe a wide difference between
    all the algorithms. However, this will become more evident in the
    two following tests.
    
    \begin{figure}[H]
        \centering
        \resizebox{0.45\textwidth}{!}{
        \begin{tikzpicture}
            \begin{axis}[
                title={Broadcast test (1 Kb)},
                xlabel={Number of processes},
                ylabel={Latency ($\mu$s)},
                legend pos=north west,
                grid=both,
                grid style={line width=.1pt, draw=gray!20},
                major grid style={line width=.2pt,draw=gray!50},
                minor tick num=5,
                xtick={2, 6, 12, 18, 24, 30, 36, 42, 48},
                % xmode=log,
                % log basis x={2},
                % ymin=0,
                % xmin=0.5,
                % xmax=11.5,
                % xmax=100,
                % ytick={0, 50, 100, 150, 200, 250, 300, 350, 400},
                width=10cm,
                height=6cm,
                % cycle list name=color list,
            ]
            
            % x = [ 2  4  6  8 10 12 14 16 18 20 22 24 26 28 30 32 34 36 38 40 42 44 46 48]
            % basic-linear = [ 0.42  0.74  1.08  1.73  2.3   2.64  3.18  4.62  5.61  6.54  7.49  8.5 8.8   9.45 10.54 11.38 12.96 13.12 12.74 13.05 13.59 13.92 14.69 15.3 ]
            % chain = [0.44 0.74 1.06 1.46 1.82 1.94 2.23 2.81 3.95 4.2  4.43 4.7  4.41 4.6 4.71 5.28 7.28 7.75 7.12 7.52 7.79 7.36 7.15 7.34]
            % binary-tree = [0.44 0.83 1.22 1.55 1.88 2.   2.16 2.88 3.78 4.   4.06 4.2  3.95 4.02 4.24 5.16 6.7  6.53 6.3  6.25 6.19 6.2  6.48 6.61]
            % binomial = [0.42 0.87 1.16 1.55 1.7  1.84 2.16 2.54 3.62 3.66 3.71 3.94 3.64 3.51 3.7  4.57 6.4  6.24 5.88 5.8  5.58 5.71 5.63 5.8 ]
            
            % Blue line: basic-linear
            \addplot[
                color=blue,
                mark=none,
                ]
                coordinates {
                (2, 0.42)
                (4, 0.74)
                (6, 1.08)
                (8, 1.73)
                (10, 2.3)
                (12, 2.64)
                (14, 3.18)
                (16, 4.62)
                (18, 5.61)
                (20, 6.54)
                (22, 7.49)
                (24, 8.5)
                (26, 8.8)
                (28, 9.45)
                (30, 10.54)
                (32, 11.38)
                (34, 12.96)
                (36, 13.12)
                (38, 12.74)
                (40, 13.05)
                (42, 13.59)
                (44, 13.92)
                (46, 14.69)
                (48, 15.3)
                };
                \addlegendentry{Basic Linear}

            % Orange line: chain
            \addplot[
                color=orange,
                mark=none,
                ]
                coordinates {
                (2, 0.44)
                (4, 0.74)
                (6, 1.06)
                (8, 1.46)
                (10, 1.82)
                (12, 1.94)
                (14, 2.23)
                (16, 2.81)
                (18, 3.95)
                (20, 4.2)
                (22, 4.43)
                (24, 4.7)
                (26, 4.41)
                (28, 4.6)
                (30, 4.71)
                (32, 5.28)
                (34, 7.28)
                (36, 7.75)
                (38, 7.12)
                (40, 7.52)
                (42, 7.79)
                (44, 7.36)
                (46, 7.15)
                (48, 7.34)
                };
                \addlegendentry{Chain}

            % Green line: binary-tree
            \addplot[
                color=green,
                mark=none,
                ]
                coordinates {
                (2, 0.44)
                (4, 0.83)
                (6, 1.22)
                (8, 1.55)
                (10, 1.88)
                (12, 2)
                (14, 2.16)
                (16, 2.88)
                (18, 3.78)
                (20, 4)
                (22, 4.06)
                (24, 4.2)
                (26, 3.95)
                (28, 4.02)
                (30, 4.24)
                (32, 5.16)
                (34, 6.7)
                (36, 6.53)
                (38, 6.3)
                (40, 6.25)
                (42, 6.19)
                (44, 6.2)
                (46, 6.48)
                (48, 6.61)
                };
                \addlegendentry{Binary Tree}

            % Red line: binomial
            \addplot[
                color=red,
                mark=none,
                ]
                coordinates {
                (2, 0.42)
                (4, 0.87)
                (6, 1.16)
                (8, 1.55)
                (10, 1.7)
                (12, 1.84)
                (14, 2.16)
                (16, 2.54)
                (18, 3.62)
                (20, 3.66)
                (22, 3.71)
                (24, 3.94)
                (26, 3.64)
                (28, 3.51)
                (30, 3.7)
                (32, 4.57)
                (34, 6.4)
                (36, 6.24)
                (38, 5.88)
                (40, 5.8)
                (42, 5.58)
                (44, 5.71)
                (46, 5.63)
                (48, 5.8)
                };
                \addlegendentry{Binomial}
            
            \end{axis}
        \end{tikzpicture}
        }
    \end{figure}
    \begin{figure}[H]
        \centering
        \resizebox{0.45\textwidth}{!}{
        \begin{tikzpicture}
            \begin{axis}[
                title={Broadcast test (1 Mb)},
                xlabel={Number of processes},
                ylabel={Latency ($\mu$s)},
                legend pos=north west,
                grid=both,
                grid style={line width=.1pt, draw=gray!20},
                major grid style={line width=.2pt,draw=gray!50},
                minor tick num=5,
                xtick={2, 6, 12, 18, 24, 30, 36, 42, 48},
                % xmode=log,
                % log basis x={2},
                % ymin=0,
                % xmin=0.5,
                % xmax=11.5,
                % xmax=100,
                % ytick={0, 50, 100, 150, 200, 250, 300, 350, 400},
                width=10cm,
                height=6cm,
                % cycle list name=color list,
            ]
            
            % x = [ 2  4  6  8 10 12 14 16 18 20 22 24 26 28 30 32 34 36 38 40 42 44 46 48]
            % basic-linear = [  62.3   184.64  340.23  441.34  485.99  639.43  737.9   997.37 1113.78 1416.71 1553.68 1812.4  1699.96 1634.78 1550.19 1443.08 1433.01 1570.21 1455.46 1640.05 1625.38 1698.98 1789.84 1819.08]
            % chain = [  61.81  205.71  319.63  373.89  470.52  465.78  571.05  668.8   798.57  789.29  806.91  915.37  961.03  991.41  963.26  918.78  917.56 1023.86  1000.39 1101.16 1108.08 1100.23 1048.36 1074.3 ]
            % binary-tree = [  63.35  193.11  306.55  370.21  436.4   503.01  595.54  683.32  761.52  842.13  840.07  880.99  881.86  865.36  907.51 1033.67 1124.8  1249.66  1431.95 1609.93 1656.84 1668.19 1661.83 1719.17]
            % binomial = [  62.29  184.39  345.75  387.37  481.63  536.61  575.96  662.77  909.46 1029.22  990.14 1050.39 1078.56 1044.28 1118.66 1111.21 1062.79 1020.77 1023.83 1148.91 1219.63 1314.8  1462.38 1537.52]
            
            % Blue line: basic-linear
            \addplot[
                color=blue,
                mark=none,
                ]
                coordinates {
                (2, 62.3)
                (4, 184.64)
                (6, 340.23)
                (8, 441.34)
                (10, 485.99)
                (12, 639.43)
                (14, 737.9)
                (16, 997.37)
                (18, 1113.78)
                (20, 1416.71)
                (22, 1553.68)
                (24, 1812.4)
                (26, 1699.96)
                (28, 1634.78)
                (30, 1550.19)
                (32, 1443.08)
                (34, 1433.01)
                (36, 1570.21)
                (38, 1455.46)
                (40, 1640.05)
                (42, 1625.38)
                (44, 1698.98)
                (46, 1789.84)
                (48, 1819.08)
                };
                \addlegendentry{Basic Linear}

            % Orange line: chain
            \addplot[
                color=orange,
                mark=none,
                ]
                coordinates {
                (2, 61.81)
                (4, 205.71)
                (6, 319.63)
                (8, 373.89)
                (10, 470.52)
                (12, 465.78)
                (14, 571.05)
                (16, 668.8)
                (18, 798.57)
                (20, 789.29)
                (22, 806.91)
                (24, 915.37)
                (26, 961.03)
                (28, 991.41)
                (30, 963.26)
                (32, 918.78)
                (34, 917.56)
                (36, 1023.86)
                (38, 1000.39)
                (40, 1101.16)
                (42, 1108.08)
                (44, 1100.23)
                (46, 1048.36)
                (48, 1074.3)
                };
                \addlegendentry{Chain}

            % Green line: binary-tree
            \addplot[
                color=green,
                mark=none,
                ]
                coordinates {
                (2, 63.35)
                (4, 193.11)
                (6, 306.55)
                (8, 370.21)
                (10, 436.4)
                (12, 503.01)
                (14, 595.54)
                (16, 683.32)
                (18, 761.52)
                (20, 842.13)
                (22, 840.07)
                (24, 880.99)
                (26, 881.86)
                (28, 865.36)
                (30, 907.51)
                (32, 1033.67)
                (34, 1124.8)
                (36, 1249.66)
                (38, 1431.95)
                (40, 1609.93)
                (42, 1656.84)
                (44, 1668.19)
                (46, 1661.83)
                (48, 1719.17)
                };
                \addlegendentry{Binary Tree}

            % Red line: binomial
            \addplot[
                color=red,
                mark=none,
                ]
                coordinates {
                (2, 62.29)
                (4, 184.39)
                (6, 345.75)
                (8, 387.37)
                (10, 481.63)
                (12, 536.61)
                (14, 575.96)
                (16, 662.77)
                (18, 909.46)
                (20, 1029.22)
                (22, 990.14)
                (24, 1050.39)
                (26, 1078.56)
                (28, 1044.28)
                (30, 1118.66)
                (32, 1111.21)
                (34, 1062.79)
                (36, 1020.77)
                (38, 1023.83)
                (40, 1148.91)
                (42, 1219.63)
                (44, 1314.8)
                (46, 1462.38)
                (48, 1537.52)
                };
                \addlegendentry{Binomial}
            
            
            \end{axis}
        \end{tikzpicture}
        }
    \end{figure}
    As expected, when increasing the message size the difference in latency
    between the \enquote*{optimized} algorithms and the basic linear
    algorithm becomes more evident. This effect can be clearly assessed
    from the two following plots. The increase in latency caused by the
    network communication is more pronounced for larger messages. Notice
    the constant linear trend of the basic linear algorithm with 1 Mb
    messages. This is due to the fact that the basic linear algorithm
    sends the message from the root process to the last process in a
    linear way. Consequently the last process will receive the message
    only after all the other processes have received it. This is the
    reason why the latency increases linearly with the number of processes.
    After the first node being fully utilized, the second node starts to
    be used and the latency decreases a bit to then start increasing again,
    this time less rapidly.

